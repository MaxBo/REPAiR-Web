{% load i18n %}
{% block content %}

<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/bootstrap-tagsinput.css" />

<script type="text/template" id="implementations-template">
<button id="add-implementation" class="btn btn-primary add" title="{% trans "Add/Edit implementation" %}">
  <span class="glyphicon glyphicon-plus"></span> {% trans "Implementation" %}
</button>
<div id="implementations" class="col-12-md">
</div>

<div id="implementation-modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">{% trans "Add implementation" %}</h4>
      </div>
      <div class="modal-body">
        <table>
          <tr>
            <td> {% trans "Title" %} </td>
            <td> <input id="implementation-name-input" class="form-control"></td>
          </tr>
          <tr>
            <td> {% trans "Coordinator" %} </td>
            <td> 
              <select id="coordinator-select" class="selectpicker" style="width: 100%;">
              <% stakeholderCategories.forEach(function(category){ %>
                <optgroup label="<%= category.get('name') %>">
                  <% category.stakeholders.forEach(function(stakeholder){ %>
                  <option value="<%= stakeholder.id %>"> <%= stakeholder.get('name') %></option>
                  <% }) %>
                </optgroup>
              <% }) %>
              </select>
            </td>
          </tr>
        </table>
      </div>
      <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">{% trans "Cancel"%}</button>
        <button class="btn btn-primary confirm" aria-hidden="true">{% trans "OK"%}</button>
      </div>
    </div>
  </div>
</div>

<div id="add-solution-modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">{% trans "Add solution" %}</h4>
      </div>
      <div class="modal-body">
        {% trans "Solution" %}
        <select id="solution-select" class="selectpicker" style="width: 100%; margin-left: 10px;">
          <% solutionCategories.forEach(function(category){ %>
            <optgroup label="<%= category.get('name') %>">
              <% category.solutions.forEach(function(solution){ %>
              <option value="<%= solution.id %>"> <%= solution.get('name') %></option>
              <% }) %>
            </optgroup>
          <% }) %>
        </select>
      </div>
      <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">{% trans "Cancel"%}</button>
        <button class="btn btn-primary confirm" aria-hidden="true">{% trans "OK"%}</button>
      </div>
    </div>
  </div>
</div>
</script>

<!-- modal for an implementation item -->
<script type="text/template" id="implementation-item-template">
<div class="row bordered" style="margin-top: 15px;">
  <button class="btn btn-warning square remove" title="Remove implementation" style="float: right;">
    <span class="glyphicon glyphicon-minus"></span>
  </button>
  <button class="btn btn-primary square edit" title="Edit implementation" style="float: right; margin-right: 5px;">
    <span class="glyphicon glyphicon-pencil"></span>
  </button>
  <h3 class='title'> <%= implementation.get('name') %> </h3>
  {% trans "Coordinated by" %}:&nbsp;
  <label class='coordinator'><%= stakeholder.get('name') %></label>
  <div class="row overflow bordered" style="overflow-y: hidden;">
    <div class="grid solutions" style="float: left; height: 450px;">
    </div>
    <button title="{% trans "Add solution" %}" class="btn btn-primary round add" id='add-area-select-item-btn' style="font-size: 25px; border-radius: 45px; position: relative; height: 45px; min-width: 45px; margin: 10px; margin-top: 200px;">
      <span class="glyphicon glyphicon-plus" style="top: 50%; transform: translate(-50%, -50%); position:absolute;"></span>
    </button>
  </div>
</div>
<div id="solution-implementation-modal" class="modal fade" role="dialog" style="z-index: 10000;"></div>
</script>

<!-- modal for a solution item -->
<script type="text/template" id="solution-item-template">
<div class="item-content shaded bordered noselect">
  <div class="row handle">
    <button class="btn btn-warning square remove" title="Remove solution" style="float: right;">
      <span class="glyphicon glyphicon-minus"></span>
    </button>
    <button class="btn btn-primary square edit" title="Edit solution" style="float: right; margin-right: 5px;">
      <span class="glyphicon glyphicon-pencil"></span>
    </button>
    <h4 class='title' title="<%= solution.get('name') %>"> <%= solution.get('name') %> </h4>
  </div>
  <div class="row">
    <div class='map' style="min-height: 200px; width: 100%;">
    </div>
  </div>
  <div class="row handle">
    <table style="margin: 0px; table-layout: fixed; width: 100%;">
      <tr>
        <td> {% trans "Quantity" %}:&nbsp; </td>
        <td class="quantity" style="overflow: hidden; text-overflow: ellipsis;"></td>
      </tr>
      <tr>
        <td> {% trans "Implemented by" %}:&nbsp; </td>
        <td class="implemented-by" style="overflow: hidden; text-overflow: ellipsis;">
          <%= stakeholderNames %>
        </td>
      </tr>
    </table>
    <textarea rows="4" disabled name='notes' style='width: 100%; max-width: 100%;'><%= solutionInImpl.get('note') %> </textarea>
  </div>
</div>
</script>

<!-- modal for editing/viewing a solution-->
<script type="text/template" id="view-solution-implementation-template">
<div class="modal-dialog modal-lg" style="width: 80%; height: 70%;">
  <!-- Modal content-->
  <div class="modal-content col-md-12">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
      <h4 class="modal-title">{% trans "Edit solution " %} <b> <%= solution.get('name') %> </b>{% trans " in implementation" %}<b> <%= implementation.get('name') %></b></h4>
    </div>
    <div class="modal-body">
      <div class="row">
        <ul class="nav nav-tabs">
          <li class="active"><a data-toggle="tab" href="#implementation-area-tab">{% trans "Implementation Area" %}</a></li>
          <li><a data-toggle="tab" href="#quantities-tab">{% trans "Quantities" %}</a></li>
          <li><a data-toggle="tab" href="#implementation-by-tab">{% trans "Implementation by" %}</a></li>
          <li><a data-toggle="tab" href="#notes-tab">{% trans "Notes" %}</a></li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane fade in active" id="implementation-area-tab">
            <div class="col-md-12 bordered">
              <div style="min-height: 600px; width: 100%; height: 100%;" id='editor-map'>
                <div class="drawing-tools row">
                  <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <label class="btn btn-secondary active" title="{% trans "Move Map" %}">
                      <input type="radio" class="tool" name="options" data-tool="Move" autocomplete="off" checked>
                      <span class="fas fa-arrows-alt"></span>
                    </label>
                    <label class="btn btn-secondary" title="{% trans "Select features" %}">
                      <input type="radio" class="tool" name="options" data-tool="Select" autocomplete="off">
                      <span class="far fa-hand-point-up"></span>
                    </label>
                    <!--seperate dragbox tool disabled, doesn't work with touch-->
                    <!-- 
                    <label class="btn btn-secondary" title="{% trans "Select Features" %}">
                      <input type="radio" class="tool" name="options" data-tool="DragBox" autocomplete="off">
                      <div style="border: 1px black dashed; width: 18px; height: 18px;"></div>
                    </label>
                    -->
                    <label class="btn btn-secondary" title="{% trans "Draw Polygons" %}">
                      <input type="radio" class="tool" name="options" data-tool="Polygon" autocomplete="off">
                      <span class="fas fa-draw-polygon"></span>
                    </label>
                    <label class="btn btn-secondary" title="{% trans "Draw Points" %}">
                      <input type="radio" class="tool" name="options" data-tool="Point" autocomplete="off">
                      <span class="fas fa-circle" style="font-size: 10px;"></span>
                    </label>
                    <label class="btn btn-secondary" title="{% trans "Draw Lines" %}">
                      <input type="radio" class="tool" name="options" data-tool="LineString" autocomplete="off">
                      <span class="glyphicon glyphicon-minus"></span>
                    </label>
                  </div>
                  <input class="freehand" type="checkbox" checked style="transform: scale(2); margin-left: 20px; margin-right: 8px;"> 
                  <label style="text-shadow: 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff;">{% trans "freehand" %}</label>
                  <button class="remove btn btn-danger round" style="margin-left: 10px; display: none;"> <span class="glyphicon glyphicon-remove-sign" ></span> {% trans "selection" %} </button>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-pane fade in" id="quantities-tab">
            <div class="col-md-12 bordered">
              <div class="row">
                <h4> {% trans "General definition" %} </h4>
                {% trans "For the solution" %} <i> <%= solution.get('name') %> </i>{% trans "one unit equals" %}: <b> <%= solution.get('one_unit_equals') %> </b> <br><br>
                {% trans "This unit is defined by the following ratios" %}
                <div id="ratios"></div>
              </div>
              <div class="row">
                <h4> {% trans "Your implementation" %} </h4>
                {% trans "In the implementation area, this quantities shall be implemented:" %}
                <table id="implemented-quantities"></table>
              </div>
            </div>
          </div>
          <div class="tab-pane fade in" id="implementation-by-tab">
            <div class="col-md-12 bordered">
              <div class="row" style="margin-top: 15px">
                {% trans "Stakeholders in charge of the solutionâ€™s implementation in the implementation area" %}:
              </div>
              <div class="row">
                <select id="implementation-stakeholders" class="selectpicker" multiple data-width="500px">
                <% stakeholderCategories.forEach(function(category){ %>
                  <optgroup label="<%= category.get('name') %>">
                    <% category.stakeholders.forEach(function(stakeholder){ %>
                    <option value="<%= stakeholder.id %>"> <%= stakeholder.get('name') %></option>
                    <% }) %>
                  </optgroup>
                <% }) %>
                </select>
              </div>
            </div>
          </div>
          <div class="tab-pane fade in" id="notes-tab">
            <div class="col-md-12 bordered">
              <div class="row">
                <textarea name="description" rows="10" cols="100" style="max-width: 100%;"><%= solutionImpl.get('note') %></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true">{% trans "Cancel"%}</button>
      <button class="btn btn-primary confirm" aria-hidden="true">{% trans "OK"%}</button>
    </div>
  </div>
</div>
</script>

{% endblock %}